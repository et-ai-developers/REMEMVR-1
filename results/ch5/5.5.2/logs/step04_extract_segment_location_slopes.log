[START] Step 4: Extract segment-location slopes
[LOAD] Loading fitted piecewise LMM model...
[LOADED] Piecewise LMM model from step03_piecewise_lmm_model.pkl
[INFO] Model has 8 fixed effects coefficients
[INFO] Coefficients: ['Intercept', 'Segment[T.Late]', 'LocationType[T.Destination]', 'Segment[T.Late]:LocationType[T.Destination]', 'Days_within', 'Days_within:Segment[T.Late]', 'Days_within:LocationType[T.Destination]', 'Days_within:Segment[T.Late]:LocationType[T.Destination]']
[EXTRACT] Extracting variance-covariance matrix...
[EXTRACTED] Variance-covariance matrix shape: (11, 11)
[IDENTIFY] Identifying coefficient indices for slope calculations...
[FOUND] Days_within index: 4
[FOUND] Days_within:Segment[T.Late] index: 5
[FOUND] Days_within:LocationType[T.Destination] index: 6
[FOUND] Days_within:Segment[T.Late]:LocationType[T.Destination] index: 7
[COMPUTE] Computing segment-location slopes via linear combinations...
[COMPUTED] Source_Early slope: -0.206219
[COMPUTED] Source_Late slope: -0.104042
[COMPUTED] Destination_Early slope: -0.209130
[COMPUTED] Destination_Late slope: -0.046292
[DELTA] Applying delta method for SE propagation...
[ERROR] shapes (8,) and (11, 11) not aligned
[TRACEBACK] Full error details:
Traceback (most recent call last):
  File "/home/etai/projects/REMEMVR/.venv/lib/python3.12/site-packages/pandas/core/frame.py", line 1803, in __rmatmul__
    return self.T.dot(np.transpose(other)).T
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/etai/projects/REMEMVR/.venv/lib/python3.12/site-packages/pandas/core/frame.py", line 1757, in dot
    raise ValueError(
ValueError: Dot product shape mismatch, (11, 11) vs (8,)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/etai/projects/REMEMVR/results/ch5/5.5.2/code/step04_extract_segment_location_slopes.py", line 237, in <module>
    se_source_late = np.sqrt(gradient_source_late @ vcov_matrix @ gradient_source_late)
                             ~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/home/etai/projects/REMEMVR/.venv/lib/python3.12/site-packages/pandas/core/generic.py", line 2193, in __array_ufunc__
    return arraylike.array_ufunc(self, ufunc, method, *inputs, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/etai/projects/REMEMVR/.venv/lib/python3.12/site-packages/pandas/core/arraylike.py", line 276, in array_ufunc
    result = maybe_dispatch_ufunc_to_dunder_op(self, ufunc, method, *inputs, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pandas/_libs/ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "/home/etai/projects/REMEMVR/.venv/lib/python3.12/site-packages/pandas/core/frame.py", line 1809, in __rmatmul__
    raise ValueError(msg) from err
ValueError: shapes (8,) and (11, 11) not aligned
[START] Step 4: Extract segment-location slopes
[LOAD] Loading fitted piecewise LMM model...
[LOADED] Piecewise LMM model from step03_piecewise_lmm_model.pkl
[INFO] Model has 8 fixed effects coefficients
[INFO] Coefficients: ['Intercept', 'Segment[T.Late]', 'LocationType[T.Destination]', 'Segment[T.Late]:LocationType[T.Destination]', 'Days_within', 'Days_within:Segment[T.Late]', 'Days_within:LocationType[T.Destination]', 'Days_within:Segment[T.Late]:LocationType[T.Destination]']
[EXTRACT] Extracting variance-covariance matrix...
[EXTRACTED] Full variance-covariance matrix shape: (11, 11)
[EXTRACTED] Fixed effects vcov matrix shape: (8, 8)
[IDENTIFY] Identifying coefficient indices for slope calculations...
[FOUND] Days_within index: 4
[FOUND] Days_within:Segment[T.Late] index: 5
[FOUND] Days_within:LocationType[T.Destination] index: 6
[FOUND] Days_within:Segment[T.Late]:LocationType[T.Destination] index: 7
[COMPUTE] Computing segment-location slopes via linear combinations...
[COMPUTED] Source_Early slope: -0.206219
[COMPUTED] Source_Late slope: -0.104042
[COMPUTED] Destination_Early slope: -0.209130
[COMPUTED] Destination_Late slope: -0.046292
[DELTA] Applying delta method for SE propagation...
[DELTA] Source_Early SE: 0.080590
[DELTA] Source_Late SE: 0.029262
[DELTA] Destination_Early SE: 0.080590
[DELTA] Destination_Late SE: 0.029262
[CI] Computing 95% confidence intervals and p-values...
[CI] Source_Early: slope=-0.206219, SE=0.080590, 95%CI=[-0.364175, -0.048262], p=0.010501
[CI] Source_Late: slope=-0.104042, SE=0.029262, 95%CI=[-0.161396, -0.046688], p=0.000377
[CI] Destination_Early: slope=-0.209130, SE=0.080590, 95%CI=[-0.367086, -0.051174], p=0.009459
[CI] Destination_Late: slope=-0.046292, SE=0.029262, 95%CI=[-0.103646, 0.011063], p=0.113660
[SAVE] Saving segment-location slopes...
[SAVED] step04_segment_location_slopes.csv (4 rows, 7 columns)
[VALIDATION] Running validate_dataframe_structure...
[VALIDATION] PASS: DataFrame structure valid: 4 rows, 7 columns (required: 7).
[VALIDATION] Running additional range checks...
[VALIDATION] All range checks passed
[SUCCESS] Step 4 complete
