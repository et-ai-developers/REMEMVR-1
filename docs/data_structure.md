# REMEMVR Data Structure Reference

**Purpose:** Complete reference for master.xlsx structure, tag system, and data extraction

**Audience:** All agents working with REMEMVR data

**Last Updated:** 2025-11-14

---

## MASTER.XLSX STRUCTURE

ALL data collected during the experiment is saved in `data/master.xlsx`.

### Format:
- **Each row** = A unique datapoint
- **Each pair of columns** = Data for one participant

### Column Pair Structure:

#### First Column (Tag Column):
- **Header:** Participant UID (e.g., `A010`, `A053`, `A098`)
- **Rows:** Tags that identify what the data in the second column refers to

#### Second Column (Data Column):
- **Header:** UID-D (e.g., `A010-D`, `A053-D`, `A098-D`)
- **Rows:** The actual data values

---

## UID SYSTEM

### Format: `A{GROUP}{COUNTER}`

**Example:** `A053`
- `A` = Prefix (all participants)
- `05` = Age group (50-54 years old)
- `3` = Third participant in that age group (counter within group)

### Age Group Mapping:
| Group | Age Range | UIDs | Count |
|-------|-----------|------|-------|
| **A01** | 20-24 | A010 - A019 | 10 |
| **A02** | 25-29 | A020 - A029 | 10 |
| **A03** | 30-34 | A030 - A039 | 10 |
| **A04** | 35-39 | A040 - A049 | 10 |
| **A05** | 40-44 | A050 - A059 | 10 |
| **A06** | 45-49 | A060 - A069 | 10 |
| **A07** | 50-54 | A070 - A079 | 10 |
| **A08** | 55-59 | A080 - A089 | 10 |
| **A09** | 60-64 | A090 - A099 | 10 |
| **A10** | 65-70 | A100 - A109 | 10 |

**Total N = 100 participants**

**UID Format:** Always 1 letter + 3 numbers (e.g., A010, A053, A100)

**CRITICAL:** UID groups were for recruitment stratification. To get participant's **actual age**, use `{UID}-DEM-X-Age` tag.

---

## TAG SCHEMA

### General Format: `{UID}-{TOPIC}-{TEST}-{SECTION}-{ITEM}-{MEASURE}`

**CRITICAL:** Tags use DASHES throughout, never underscores. Tag format must match EXACTLY.

### Topics:
- **DEM** = Demographic Data (collected once on Day 0)
- **COG** = Cognitive Test Data (collected once on Day 0)
- **RVR** = REMEMVR Data (collected 4 times across tests)

### Test Numbers:
- **T1** = Test 1 (Day 0, immediately after last VR room)
- **T2** = Test 2 (Day 1)
- **T3** = Test 3 (Day 3)
- **T4** = Test 4 (Day 6)
- **X** = Data collected only once (demographics, cognitive tests)

**CRITICAL:** T1-T4 indicate when participants were INSTRUCTED to take tests. Use **TSVR** (Time Since VR, in hours) to measure ACTUAL delay period, as some participants completed tests on different schedules.

**For IRT→LMM Pipeline:** TSVR is the TIME VARIABLE for LMM trajectory analysis (NOT nominal days 0, 1, 3, 6). Extract `{UID}-RVR-{Test}-STA-X-TSVR` tags, merge with theta scores after parsing composite_ID, convert to days (TSVR_hours / 24). See **Decision D070** in project_specific_stats_insights.md for complete pipeline documentation.

### Example Tags (for participant A010):
- `A010-DEM-X-Age` = Age in years
- `A010-COG-X-NAR-Scor` = NART score (note: "Scor" not "Score")
- `A010-COG-X-RPM-Scor` = RPM score
- `A010-RVR-T1-IFR-N-i1CM-n1so1fiA-ANS` = Accuracy for item 1 in Test 1, Items Free Recall

---

## QUICK REFERENCE TABLES

### Tag Topics

| Code | Full Name | Timepoints | Description |
|------|-----------|------------|-------------|
| **DEM** | Demographic Data | Single (X) | Age, sex, education, health questionnaire, DASS |
| **COG** | Cognitive Test Data | Single (X) | RAVLT, BVMT, NART, RPM scores |
| **RVR** | REMEMVR Data | Multiple (T1-T4) | VR episodic memory test data |

**Tag Format:** `{UID}-{TOPIC}-{TIMEPOINT}-...` (e.g., `A010-DEM-X-Age`, `A010-RVR-T1-BAT-RFR-...`)

### Test Timepoint Codes

| Code | Meaning | Usage |
|------|---------|-------|
| **X** | Single timepoint | Demographic/cognitive data collected once on Day 0 |
| **T1** | Test Session 1 | REMEMVR recall test (Day 0, immediately after last VR room) |
| **T2** | Test Session 2 | REMEMVR recall test (Day 1) |
| **T3** | Test Session 3 | REMEMVR recall test (Day 3) |
| **T4** | Test Session 4 | REMEMVR recall test (Day 6) |

**Access actual delay:** Use `{UID}-RVR-T{N}-STA-X-TSVR` for hours since VR encoding.

### Room Codes

| Code | Room | Counterbalanced |
|------|------|-----------------|
| **BAT** | Bathroom | Yes - roughly equal T1/T2/T3/T4 distribution |
| **BED** | Bedroom | Yes - roughly equal T1/T2/T3/T4 distribution |
| **KIT** | Kitchen | Yes - roughly equal T1/T2/T3/T4 distribution |
| **LIV** | Living Room | Yes - roughly equal T1/T2/T3/T4 distribution |

**CRITICAL:** Room order and test order were counterbalanced. Do NOT hard-code room-to-test mappings (e.g., T1-BAT). Use regex wildcards like `A010-RVR-T1-.*-RFR` unless asking room-specific questions.

### Test Item Prefixes (Data-Prep Generated)

| Code | Meaning | Description |
|------|---------|-------------|
| **TQ_** | Test Question | Accuracy score (0, 0.25, 0.5, or 1) - generated by data.py from tags ending in `-ANS` |
| **TC_** | Test Confidence | Confidence rating (0.1-1.0, originally 1-5 Likert) - generated by data.py from tags ending in `-CON` |

**Source:** TQ_ and TC_ prefixes are created when data.py extracts tags ending with `-ANS` (answer) or `-CON` (confidence).

### Testing Paradigms (8 total)

| Code | Full Name | Description | Domains Available |
|------|-----------|-------------|-------------------|
| **SLP** | Sleep Hygiene | Pre-test questionnaire (sleep quality, caffeine, etc.) | N/A (not accuracy/confidence) |
| **RFR** | Room Free Recall | Recall room features (furniture, paintings, weather, etc.) | **-N-, -L-, -O-** |
| **IFR** | Items Free Recall | Recall the 6 interactive objects without cues | **-N-, -U-, -D-, -O-** |
| **TCR** | Task Cued Recall | Recall the 7 observational task order with spatial diagram | **-O-** only |
| **ICR** | Items Cued Recall | Recall items with multichoice + spatial diagram | **-N-, -U-, -D-, -O-** |
| **RRE** | Room Recognition | Recognize room features from visual options | **-N-, -L-** |
| **IRE** | Items Recognition | Recognize items from photos with spatial locations | **-N-, -U-, -D-, -O-** |
| **STR** | Recall Strategies | Post-test questionnaire (difficulty, strategies, mnemonics) | N/A (not accuracy/confidence) |

**Note:** SLP and STR contain questionnaire responses (critical for some RQs), not accuracy/confidence scores.

### Memory Domains (5 total)

| Code | Full Name | Description | Example | Used In |
|------|-----------|-------------|---------|---------|
| **-N-** | Name/What | Object identity | "Did you pick up a book or magazine?" | RFR, IFR, ICR, RRE, IRE |
| **-L-** | Location/Where (Static) | **Spatial location of NON-interactive objects** (furniture, fixtures, doors, windows) | "Where is the bathtub?" | RFR, RRE |
| **-U-** | Up/Pick-up location | Where interactive item was picked up from | "Did you pick it up from the sink?" | IFR, ICR, IRE |
| **-D-** | Down/Put-down location | Where interactive item was placed | "Did you put it down near the door?" | IFR, ICR, IRE |
| **-O-** | Order/When | Temporal sequence of interactions | "Was this the 3rd item you picked up?" | RFR, IFR, TCR, ICR, IRE |

**CRITICAL:** -L- is for **static objects ONLY** (furniture, paintings, doors, windows - objects that were NOT picked up or put down). Interactive items (i1-i6) use -U- (pick-up) and -D- (put-down), NOT -L-.

### Item Categories

| Code | Full Code | Category | Count per Room | Example Items | Regex Pattern |
|------|-----------|----------|----------------|---------------|---------------|
| **i1, i2** | i1CM, i2CM | Common | 2 | Book, mobile phone, keys | `-i[12]CM-` |
| **i3, i4** | i3CG, i4CG | Congruent | 2 | Toothbrush (bathroom), frying pan (kitchen) | `-i[34]CG-` |
| **i5, i6** | i5IN, i6IN | Incongruent | 2 | Hammer (bathroom), motor oil (bedroom) | `-i[56]IN-` |

**Regex Wildcards:**
- All items: `-i\d[A-Z]{2}-` (matches i1CM, i2CM, i3CG, i4CG, i5IN, i6IN)
- Common items only: `-i\dCM-`
- Incongruent items only: `-i\dIN-`
- Congruent items only: `-i\dCG-`

**Purpose:** CM/CG/IN suffixes enable wildcard filtering for item congruence analyses.

### Item Position Tags (Interactive Items Only)

**Format:** `-n[1-6]s[location]f[location]-`

**Interaction Order:**
| Code | Meaning | Example |
|------|---------|---------|
| **n1-n6** | 1st to 6th item picked up | `-n2-` = 2nd item picked up |

**Starting Position (s):**
| Code | Meaning | Details |
|------|---------|---------|
| **so1-so4** | Started Outside | Pillar 1, 2, 3, or 4 |
| **siA-siD** | Started Inside | Corner A, B, C, or D |

**Finishing Position (f):**
| Code | Meaning | Details |
|------|---------|---------|
| **fiA-fiD** | Finished Inside | Corner A, B, C, or D |
| **fo1-fo4** | Finished Outside | Pillar 1, 2, 3, or 4 |

**Examples:**
- `-n2siCfiD-` = 2nd item picked up, started inside corner C, finished inside corner D
- `-n6so3fiB-` = 6th item picked up, started outside pillar 3, finished inside corner B

**Usage:** Primacy/recency effects (n1 vs n6), location congruence (si vs so). These tags only appear in interactive item tags (i1-i6), NOT room features.

### Statistical/Analysis Terms

| Code | Full Name | Description |
|------|-----------|-------------|
| **CTT** | Classical Test Theory | Traditional sum-score approach to scoring |
| **IRT** | Item Response Theory | Latent trait modeling using deepirtools |
| **GRM** | Graded Response Model | IRT model for polytomous data |
| **LMM** | Linear Mixed Model | Longitudinal trajectory modeling (statsmodels) |
| **TSVR** | Time Since VR | Time elapsed since VR encoding (in hours) - USE THIS for delay period, not T1/T2/T3/T4 |

### Cognitive Tests

| Tag Code | Full Name | Purpose | Tag Example |
|----------|-----------|---------|-------------|
| **NAR** | National Adult Reading Test (NART) | Premorbid IQ estimate | `{UID}-COG-X-NAR-Scor` |
| **RPM** | Raven's Progressive Matrices | Fluid intelligence | `{UID}-COG-X-RPM-Scor` |
| **BVM** | Brief Visuospatial Memory Test-Revised (BVMT-R) | Visual/spatial memory | `{UID}-COG-X-BVM-TotR` |
| **RAV** | Rey Auditory Verbal Learning Test (RAVLT) | Verbal episodic memory | `{UID}-COG-X-RAV-T1Sc` |

**Note:** Tag abbreviations (NAR, RPM, BVM, RAV) differ from full acronyms (NART, RPM, BVMT-R, RAVLT).

### Questionnaires

| Code | Full Name | Description |
|------|-----------|-------------|
| **DASS** | Depression Anxiety Stress Scale | 21-item questionnaire (DASS1-DASS21, plus subscales: DASS_Dep, DASS_Anx, DASS_Str) |

---

## DEMOGRAPHIC DATA (DEM)

### General Demographic Info:
| Tag | Range | Question |
|-----|-------|----------|
| `{UID}-DEM-X-Age` | 20-70 | What is your age in years? |
| `{UID}-DEM-X-Sex` | 0-3 | What was your assigned sex at birth? [Female, Male, Other, Prefer not to say] |
| `{UID}-DEM-X-Education` | 0-9 | Highest completed level of education |
| `{UID}-DEM-X-VR_Exp` | 0-4 | Hours of VR experience [Never, <1hr, 1-10hrs, 10-50hrs, >50hrs] |
| `{UID}-DEM-X-SLEEP` | 0-24 | Typical hours of sleep per night |
| `{UID}-DEM-X-Tester` | 0-1 | Which researcher collected data [Jayce, Richard] |

### Health Questionnaire (HQ):
9 yes/no questions about medical history:
- `{UID}-DEM-X-HQ1` = Adverse VR experience
- `{UID}-DEM-X-HQ2` = Seizure
- `{UID}-DEM-X-HQ3` = Stroke
- `{UID}-DEM-X-HQ4` = Clinical EEG
- `{UID}-DEM-X-HQ5` = Serious head injury
- `{UID}-DEM-X-HQ6` = Brain injury from illness
- `{UID}-DEM-X-HQ7` = Other brain condition
- `{UID}-DEM-X-HQ8` = Frequent/severe headaches
- `{UID}-DEM-X-HQ9` = Medications (including contraceptives)
- `{UID}-DEM-X-HQTXT` = Text details if any "yes" responses

### DASS-21 (Depression, Anxiety, Stress Scale):
21 items scored 0-3:
- `{UID}-DEM-X-DASS1` through `{UID}-DEM-X-DASS21`

**Computed Totals:**
- `{UID}-DEM-X-DASS_Dep` = Depression total
- `{UID}-DEM-X-DASS_Anx` = Anxiety total
- `{UID}-DEM-X-DASS_Str` = Stress total

---

## COGNITIVE TEST DATA (COG)

### NART (National Adult Reading Test):
- `{UID}-COG-X-NAR-Time` = Test duration (seconds)
- `{UID}-COG-X-NAR-Scor` = NART score (0-50)

**Note:** "Scor" not "Score" - exact spelling matters!

### RPM (Raven's Progressive Matrices):
- `{UID}-COG-X-RPM-Time` = Test duration (seconds)
- `{UID}-COG-X-RPM-Scor` = RPM score (0-12)

**Individual Puzzle Choices:**
- `{UID}-COG-X-RPM-Tr01` through `{UID}-COG-X-RPM-Tr12` = Individual puzzle choices (0-8)

### BVMT-R (Brief Visuospatial Memory Test - Revised):

**3 Immediate Recall Trials:**
- `{UID}-COG-X-BVM-T1Ti` = Trial 1 duration (seconds)
- `{UID}-COG-X-BVM-T1Sc` = Trial 1 score (0-12)
- `{UID}-COG-X-BVM-T2Ti`, `{UID}-COG-X-BVM-T2Sc` = Trial 2
- `{UID}-COG-X-BVM-T3Ti`, `{UID}-COG-X-BVM-T3Sc` = Trial 3

**Delayed Recall Trial:**
- `{UID}-COG-X-BVM-TDTD` = Delay period (seconds)
- `{UID}-COG-X-BVM-TDTi` = Delayed trial duration
- `{UID}-COG-X-BVM-TDSc` = Delayed trial score (0-12)

**Computed Scores:**
- `{UID}-COG-X-BVM-TotR` = Total Recall
- `{UID}-COG-X-BVM-Lear` = Learning
- `{UID}-COG-X-BVM-PerR` = Percent Retained
- `{UID}-COG-X-BVM-ReHi` = Recognition Hits
- `{UID}-COG-X-BVM-ReFA` = Recognition False Alarms
- `{UID}-COG-X-BVM-ReDI` = Recognition Discrimination Index
- `{UID}-COG-X-BVM-ReRB` = Recognition Response Bias

### RAVLT (Rey Auditory Verbal Learning Test):

**5 Immediate Recall Trials (List A):**
- `{UID}-COG-X-RAV-T1Ti` through `{UID}-COG-X-RAV-T5Ti` = Trial durations
- `{UID}-COG-X-RAV-T1Sc` through `{UID}-COG-X-RAV-T5Sc` = Trial scores (0-15)

**Distraction Trial (List B):**
- `{UID}-COG-X-RAV-TDTi` = Distraction trial duration
- `{UID}-COG-X-RAV-TDSc` = Distraction score (0-15)

**Free Recall Trial (List A):**
- `{UID}-COG-X-RAV-FRTi` = Free recall duration
- `{UID}-COG-X-RAV-FRSc` = Free recall score (0-15)

**Delayed Recall Trial (List A):**
- `{UID}-COG-X-RAV-DRDe` = Delay period
- `{UID}-COG-X-RAV-DRTi` = Delayed recall duration
- `{UID}-COG-X-RAV-DRSc` = Delayed recall score (0-15)

**Recognition Trial:**
- `{UID}-COG-X-RAV-RXXA` = Recognition Hits (List A, 0-15)
- `{UID}-COG-X-RAV-RXSA` = False Alarms (List A, semantically similar)
- `{UID}-COG-X-RAV-RXPA` = False Alarms (List A, phonetically similar)
- `{UID}-COG-X-RAV-RSPA` = False Alarms (List A, semantically + phonetically similar)
- `{UID}-COG-X-RAV-RXXB` = False Alarms (List B)
- `{UID}-COG-X-RAV-RXSB` = False Alarms (List B, semantically similar)
- `{UID}-COG-X-RAV-RXPB` = False Alarms (List B, phonetically similar)
- `{UID}-COG-X-RAV-RSPB` = False Alarms (List B, semantically + phonetically similar)

---

## REMEMVR DATA (RVR)

### General Variables:
- `{UID}-RVR-X-VR1` through `{UID}-RVR-X-VR4` = Order rooms were viewed [bat, bed, kit, liv]
- `{UID}-RVR-T1-Room` through `{UID}-RVR-T4-Room` = Which room each test asked about

### Per-Test Statistics (example for T1):
- `{UID}-RVR-T1-STA-X-Date` = Test date (days since 01/01/1904)
- `{UID}-RVR-T1-STA-X-Time` = Test time (0-1, proportion of 24 hours)
- `{UID}-RVR-T1-STA-X-TSLt` = Hours since last test
- `{UID}-RVR-T1-STA-X-TSVR` = Hours since saw room in VR
- `{UID}-RVR-T1-STA-X-TiPS-RFR` through `{UID}-RVR-T1-STA-X-TiPS-IRE` = Section completion times

### Sleep Hygiene (collected at each test):
- `{UID}-RVR-T1-SLP-X-AWAK-` = Hours awake (proportion of 24 hours)
- `{UID}-RVR-T1-SLP-X-HOUR-` = Hours slept last night
- `{UID}-RVR-T1-SLP-X-WAKE-` = Wake time (proportion of 24 hours)
- `{UID}-RVR-T1-SLP-X-QUAL-` = Sleep quality (-1 to 1)
- `{UID}-RVR-T1-SLP-X-TIRE-` = Tiredness (-1 to 1)
- `{UID}-RVR-T1-SLP-X-CAF1-` = Caffeine consumed? (0/1)
- `{UID}-RVR-T1-SLP-X-CAF2-` = Which stimulant, how many servings (text)
- `{UID}-RVR-T1-SLP-X-TOX1-` = Intoxicants consumed? (0/1)
- `{UID}-RVR-T1-SLP-X-TOX2-` = Which substance, how many servings (text)
- `{UID}-RVR-T1-SLP-X-HLP1-` = Anyone helping? (0/1)
- `{UID}-RVR-T1-SLP-X-HLP2-` = Relationship to helper (text)

### Answer/Confidence Flags:
- **-ANS** = Accuracy score for that question (0, 0.5, or 1)
- **-CON** = Confidence rating for that question (0-1, rescaled from 1-5 Likert)

---

## REMEMVR TEST SECTIONS

### 1. Room Free Recall (RFR):
Participants recall room features without cues.

**Items:**
- **OBJ1, OBJ2, OBJ3, OBJ4** = Four largest furniture items [-N-, -L-]
- **STRA** = Large strange object [-N-, -L-]
- **LAND** = Landscape painting [-N-, -L-]
- **PORT** = Portrait painting [-N-, -L-]
- **RORD** = Order this room was viewed [-O-]
- **TMOD** = Time of day in VR [-O-]
- **WEAT** = Weather outside [-N-]
- **DOOR** = Location of doors [-L-]
- **WIND** = Location of windows [-L-]

### 2. Items Free Recall (IFR):
Participants list 6 items, where picked up/put down, order.

**Items:**
- **-i1CM-** through **-i6IN-** = Each item [-N-, -U-, -D-, -O-]

### 3. Task Cued Recall (TCR):
Participants recall order of 6 observational tasks with spatial diagram.

**Items:**
- **TSK1** through **TSK6** = 6 tasks [-O-]

### 4. Items Cued Recall (ICR):
Participants recall items with multichoice + spatial diagram.

**Items:**
- Same structure as IFR

### 5. Room Recognition (RRE):
Recognize room features from visual options.

**Items:**
- **DOOR** = Door location [-L-]
- **WIND** = Window location [-L-]
- **STRA** = Strange object [-N-, -L-]
- **LAND** = Landscape painting [-N-, -L-]
- **PORT** = Portrait painting [-N-, -L-]

### 6. Items Recognition (IRE):
Recognize items from photos + spatial locations.

**Items:**
- Same structure as IFR and ICR

### 7. Strategy Questionnaire (STR):
Self-report strategies, difficulty, rehearsal.

**Items:**
- `{UID}-RVR-T1-STR-X-DIF1-` = Difficulty rating (-1 to 1)
- `{UID}-RVR-T1-STR-X-DIF2-` = Difficulty compared to previous test (-1 to 1)
- `{UID}-RVR-T1-STR-X-HLP1-` = Did previous tests help? (text)
- `{UID}-RVR-T1-STR-X-HLP2-` = How did they help? (text)
- `{UID}-RVR-T1-STR-X-TNK1-` = How often thought about room (-1 to 1)
- `{UID}-RVR-T1-STR-X-TNK2-` = What elements thought about (text)
- `{UID}-RVR-T1-STR-X-OBJ1-` = Strategies for furniture/fixtures (text)
- `{UID}-RVR-T1-STR-X-ITM1-` = Strategies for items (text)
- `{UID}-RVR-T1-STR-X-MNE1-` = Aware of mnemonic techniques? (text)
- `{UID}-RVR-T1-STR-X-MNE2-` = Apply mnemonics? (text)
- `{UID}-RVR-T1-STR-X-MNE3-` = Describe technique (text)
- `{UID}-RVR-T1-STR-X-FEED-` = General feedback (text)

---

## EXAMPLE TAG BREAKDOWN

**Tag:** `A053-RVR-T2-IFR-N-i3CG-n2siCfiD-ANS`

**Parsing:**
- `A053` = Participant ID (age group 50-54, participant #3)
- `RVR` = REMEMVR data
- `T2` = Test 2 (Day 1)
- `IFR` = Items Free Recall section
- `N` = What domain (object identity)
- `i3CG` = Item 3, congruent
- `n2` = 2nd item picked up in sequence
- `siC` = Started inside in corner C
- `fiD` = Finished inside in corner D
- `ANS` = Accuracy score

**Interpretation:** This is the accuracy score for participant A053 on Test 2, in the Items Free Recall section, for the "What" question about the 3rd item (which was congruent), which was the 2nd item they picked up, started in corner C and finished in corner D.

---

## DATA EXTRACTION WORKFLOW (NEW METHOD)

### Step 1: Data-Prep Agent Interaction with data.py

**OLD METHOD (DEPRECATED):** Using variables.xlsx with regex patterns

**NEW METHOD:** Data-prep agent interacts directly with data.py to create RQ-specific dataframes

**Process:**
1. Data-prep agent reads RQ requirements from info.md
2. Determines which tags are needed
3. Calls data.py functions directly to extract specific tags
4. Creates input.csv tailored to that specific RQ
5. No intermediate variables.xlsx needed

### Step 2: Handle Different Data Sources

**Not all RQs use master.xlsx!**

**Data sources can be:**
1. **master.xlsx** - Raw experimental data (most RQs)
2. **Previous RQ outputs** - E.g., theta estimates from IRT (Chapter 7 RQs)
3. **Computed scores** - E.g., cognitive test T-scores
4. **Mixed sources** - Combine master.xlsx + previous RQ outputs

**Example:** RQ 7.1 needs:
- Theta scores from RQ 5.1 output (not master.xlsx)
- Cognitive test scores from master.xlsx
- Age/demographics from master.xlsx

### Step 3: Validation

Data-prep agent validates input.csv:
- Correct columns present
- Correct number of rows (expected N)
- No unexpected missing values
- Data types correct

---

## CODE EXAMPLES USING NEW API

**Full API Documentation:** See `data/README.md`

### Example 1: Extract Demographic Data

Extract age, sex, and education for all participants:

```python
from data.data import extract_tags

# Extract demographic variables
demographics = extract_tags(
    tag_patterns={
        'Age': '{UID}-DEM-X-Age',
        'Sex': '{UID}-DEM-X-Sex',
        'Education': '{UID}-DEM-X-Education',
        'VR_Experience': '{UID}-DEM-X-VR_Exp'
    },
    expected_rows=100,
    expected_cols=5  # UID + 4 variables
)

print(demographics.head())
#     UID  Age  Sex  Education  VR_Experience
# 0  A010   22    0          7              1
# 1  A011   23    1          9              0
# 2  A012   24    0          7              2
```

### Example 2: Extract Cognitive Test Scores

Extract RPM and NART scores (note the "Scor" spelling):

```python
from data.data import extract_tags

# CRITICAL: Use "Scor" not "Score"
cognitive = extract_tags(
    tag_patterns={
        'RPM_Score': '{UID}-COG-X-RPM-Scor',
        'NART_Score': '{UID}-COG-X-NAR-Scor'
    },
    allow_missing={'NART_Score': 5},  # Some participants missing NART
    expected_rows=100,
    expected_cols=3  # UID + 2 scores
)
```

### Example 3: Compute RAVLT Total Score

Extract and sum RAVLT Trial 1-5 scores:

```python
from data.data import extract_cognitive_scores

# Compute RAVLT_Total (sum of 5 immediate recall trials)
ravlt_data = extract_cognitive_scores(
    test_name='RAVLT',
    scores_to_compute={
        'RAVLT_Total': ['T1Sc', 'T2Sc', 'T3Sc', 'T4Sc', 'T5Sc']
    },
    expected_count=100
)

print(ravlt_data.head())
#     UID  RAVLT_Total
# 0  A010         48.0
# 1  A011         52.0
# 2  A012         45.0
```

### Example 4: Extract VR Item Accuracy Across All 4 Tests

Extract accuracy for Item 1 (common) across all tests:

```python
from data.data import extract_vr_tags

# Extract Item 1 accuracy (IFR, What domain)
# Tag format: A010-RVR-T1-IFR-N-i1CM-n{X}s{Y}f{Z}-ANS
# The middle part (item details) is wildcarded automatically

item1_accuracy = extract_vr_tags(
    paradigm='IFR',      # Items Free Recall
    domain='N',          # What domain
    item='i1CM',         # Item 1, Common
    measure='ANS',       # Accuracy (not CON)
    expected_rows=400    # 100 participants × 4 tests
)

print(item1_accuracy.head(8))
#     UID  test  value
# 0  A010     1    1.0
# 1  A010     2    1.0
# 2  A010     3    0.5
# 3  A010     4    1.0
# 4  A011     1    1.0
# 5  A011     2    1.0
# 6  A011     3    1.0
# 7  A011     4    0.5
```

### Example 5: Extract VR Confidence Ratings

Extract confidence for the same item:

```python
from data.data import extract_vr_tags

# Same as above, but measure='CON' for confidence
item1_confidence = extract_vr_tags(
    paradigm='IFR',
    domain='N',
    item='i1CM',
    measure='CON',       # Confidence rating (0-1, rescaled from 1-5)
    expected_rows=400
)
```

### Example 6: Extract Room Free Recall Weather Question

Extract accuracy for weather question across all tests:

```python
from data.data import extract_vr_tags

# Room Free Recall: Weather question (What domain)
weather_accuracy = extract_vr_tags(
    paradigm='RFR',      # Room Free Recall
    domain='N',          # What domain
    item='WEAT',         # Weather item
    measure='ANS',       # Accuracy
    expected_rows=400
)
```

### Example 7: Extract Temporal Order Questions

Extract "when" questions (order) for Item 1:

```python
from data.data import extract_vr_tags

# Items Free Recall: When was Item 1 picked up?
item1_order = extract_vr_tags(
    paradigm='IFR',
    domain='O',          # When/Order domain
    item='i1CM',
    measure='ANS',
    expected_rows=400
)
```

### Example 8: Extract Spatial Pick-up Location

Extract "where-up" questions (pick-up location) for Item 1:

```python
from data.data import extract_vr_tags

# Items Free Recall: Where was Item 1 picked up?
item1_pickup = extract_vr_tags(
    paradigm='IFR',
    domain='U',          # Up/Pick-up domain
    item='i1CM',
    measure='ANS',
    expected_rows=400
)
```

### Example 9: Pivot VR Data to Wide Format

Convert long-format VR data to wide format for analysis:

```python
from data.data import extract_vr_tags
import pandas as pd

# Extract Item 1 accuracy (long format)
item1_long = extract_vr_tags(
    paradigm='IFR',
    domain='N',
    item='i1CM',
    measure='ANS',
    expected_rows=400
)

# Pivot to wide format
item1_wide = item1_long.pivot(
    index='UID',
    columns='test',
    values='value'
).reset_index()

# Rename columns for clarity
item1_wide.columns = ['UID', 'Item1_T1', 'Item1_T2', 'Item1_T3', 'Item1_T4']

print(item1_wide.head())
#     UID  Item1_T1  Item1_T2  Item1_T3  Item1_T4
# 0  A010       1.0       1.0       0.5       1.0
# 1  A011       1.0       1.0       1.0       0.5
# 2  A012       0.5       1.0       1.0       1.0
```

### Example 10: Extract Multiple Items and Domains

Extract all 6 items, all 4 domains (What, Where-Up, Where-Down, When):

```python
from data.data import extract_vr_tags
import pandas as pd

items = ['i1CM', 'i2CM', 'i3CG', 'i4CG', 'i5IN', 'i6IN']
domains = {'What': 'N', 'Where_Up': 'U', 'Where_Down': 'D', 'When': 'O'}

all_data = []

for item in items:
    for domain_name, domain_code in domains.items():
        # Extract this item × domain combination
        data = extract_vr_tags(
            paradigm='IFR',
            domain=domain_code,
            item=item,
            measure='ANS',
            expected_rows=400
        )

        # Add identifiers
        data['item'] = item
        data['domain'] = domain_name
        all_data.append(data)

# Combine all extractions
combined = pd.concat(all_data, ignore_index=True)
# Result: Long-format with columns ['UID', 'test', 'value', 'item', 'domain']
# Total rows: 100 participants × 4 tests × 6 items × 4 domains = 9,600 rows
```

### Example 11: Combine Demographics + Cognitive + VR Data

Full RQ data preparation workflow:

```python
from data.data import extract_tags, extract_cognitive_scores, extract_vr_tags, combine_data_sources
import pandas as pd

# Step 1: Extract demographics
demographics = extract_tags(
    tag_patterns={
        'Age': '{UID}-DEM-X-Age',
        'Education': '{UID}-DEM-X-Education'
    }
)

# Step 2: Compute RAVLT total
ravlt = extract_cognitive_scores(
    test_name='RAVLT',
    scores_to_compute={'RAVLT_Total': ['T1Sc', 'T2Sc', 'T3Sc', 'T4Sc', 'T5Sc']}
)

# Step 3: Extract VR accuracy and pivot to wide
vr_item1 = extract_vr_tags(
    paradigm='IFR', domain='N', item='i1CM', measure='ANS'
)
vr_wide = vr_item1.pivot(index='UID', columns='test', values='value').reset_index()
vr_wide.columns = ['UID', 'Item1_T1', 'Item1_T2', 'Item1_T3', 'Item1_T4']

# Step 4: Merge all data sources
full_data = demographics.merge(ravlt, on='UID').merge(vr_wide, on='UID')

# Validate
from data.data import validate_extraction
validation = validate_extraction(
    full_data,
    expected_rows=100,
    expected_cols=8,  # UID + Age + Edu + RAVLT + 4 VR tests
    required_cols=['UID', 'Age', 'RAVLT_Total', 'Item1_T1']
)

if validation['valid']:
    full_data.to_csv('results/ch5/rq1/data/input.csv', index=False)
    print("✅ Data prepared successfully!")
else:
    print("❌ Validation failed:", validation['errors'])
```

### Example 12: Extract Sleep Hygiene Data

Extract sleep-related variables for Test 1:

```python
from data.data import extract_tags

# Extract sleep hygiene data from Test 1
# Note: These tags end with '-' (trailing dash)
sleep_data = extract_tags(
    tag_patterns={
        'Hours_Awake': '{UID}-RVR-T1-SLP-X-AWAK-',
        'Hours_Slept': '{UID}-RVR-T1-SLP-X-HOUR-',
        'Sleep_Quality': '{UID}-RVR-T1-SLP-X-QUAL-',
        'Tiredness': '{UID}-RVR-T1-SLP-X-TIRE-'
    },
    expected_rows=100,
    expected_cols=5
)
```

### Example 13: Extract DASS-21 Computed Totals

Extract depression, anxiety, and stress scores:

```python
from data.data import extract_tags

# Extract DASS-21 computed totals
dass_totals = extract_tags(
    tag_patterns={
        'DASS_Depression': '{UID}-DEM-X-DASS_Dep',
        'DASS_Anxiety': '{UID}-DEM-X-DASS_Anx',
        'DASS_Stress': '{UID}-DEM-X-DASS_Str'
    },
    expected_rows=100,
    expected_cols=4
)
```

### Example 14: Load Previous RQ Output

Load theta scores from a previous IRT analysis:

```python
from data.data import load_rq_output

# Load theta scores from RQ 5.1
theta_scores = load_rq_output(
    file_path='results/ch5/rq1/data/output.csv',
    required_cols=['UID', 'theta_what', 'theta_where', 'theta_when'],
    expected_rows=100
)

print(theta_scores.head())
#     UID  theta_what  theta_where  theta_when
# 0  A010        0.52         0.34        0.68
# 1  A011        0.61         0.42        0.79
```

### Example 15: Combine Master Tags + Previous RQ Output

Use the `combine_data_sources()` function for complex data prep:

```python
from data.data import combine_data_sources

# Combine demographics from master.xlsx + theta scores from RQ 5.1
full_data = combine_data_sources(
    master_tags={
        'Age': '{UID}-DEM-X-Age',
        'Education': '{UID}-DEM-X-Education',
        'RPM_Score': '{UID}-COG-X-RPM-Scor'
    },
    rq_outputs=[
        'results/ch5/rq1/data/output.csv'  # Contains theta_what, theta_where, theta_when
    ],
    expected_rows=100,
    expected_cols=7  # UID + Age + Edu + RPM + 3 thetas
)

print(full_data.head())
#     UID  Age  Education  RPM_Score  theta_what  theta_where  theta_when
# 0  A010   22          7        8.0        0.52         0.34        0.68
# 1  A011   23          9       10.0        0.61         0.42        0.79
```

---

## QUICK TAG REFERENCE CHEAT SHEET

| Data Type | Example Tag Pattern | Extract Function |
|-----------|---------------------|------------------|
| **Single demographic** | `{UID}-DEM-X-Age` | `extract_tag()` |
| **Multiple demographics** | Dict of patterns | `extract_tags()` |
| **Cognitive score (existing)** | `{UID}-COG-X-RPM-Scor` | `extract_tag()` |
| **Cognitive score (computed)** | RAVLT_Total = T1+T2+T3+T4+T5 | `extract_cognitive_scores()` |
| **VR accuracy/confidence** | Wildcarded pattern | `extract_vr_tags()` |
| **Previous RQ output** | File path to CSV | `load_rq_output()` |
| **Mixed data sources** | Master + RQ + computed | `combine_data_sources()` |

**Remember:**
- Tags use DASHES not underscores (`RPM-Scor` not `RPM_Scor`)
- Cognitive tests use "Scor" not "Score"
- VR tags have item details wildcarded (use `extract_vr_tags()`)
- Always specify `expected_count`, `expected_rows`, `expected_cols` for validation
- Use TSVR for actual delay period, not T1/T2/T3/T4 labels

---

**End of Data Structure Reference**
