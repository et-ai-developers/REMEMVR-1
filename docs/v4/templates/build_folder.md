# RQ Folder Structure Specification

**Last Updated:** 2025-11-16
**Version:** 4.0
**Purpose:** Defines the mandatory folder structure for all v4.X research questions
**Audience:** rq_builder agent when creating new RQ directories

---

## How to Use This Template

This template specifies the **exact folder structure** that rq_builder agent must create for every new research question. The rq_builder agent reads this template and implements the structure according to these specifications.

**Agent Implementation (rq_builder agent):**
- Reads this template in Step 2
- Creates root folder in Step 4
- Creates all 6 subfolders in Step 5 according to these specifications
- Verifies structure correctness before reporting success

---

## Folder Names (6 Required)

The following 6 folders MUST be created inside `results/chX/rqY/`:

1. **docs/**
2. **data/**
3. **code/**
4. **logs/**
5. **plots/**
6. **results/**

**Root Path Format:**
- `results/chX/rqY/` where:
  - `chX` = chapter number (ch5, ch6, or ch7)
  - `rqY` = research question number (rq1-rq15 for ch5/ch6, rq1-rq20 for ch7)

**Example:** `results/ch5/rq1/`

---

## Creation Order

**Step 1: Create Root Folder**
- Create `results/chX/rqY/` directory
- If directory already exists, verify it is EMPTY (see Verification Steps below)
- Root folder MUST exist before creating subfolders

**Step 2: Create Subfolders**
- Create all 6 subfolders inside `results/chX/rqY/`
- Subfolders can be created in any order (no dependencies between them)
- All 6 subfolders MUST be created (none are optional)

**Recommended Implementation:**
Create in this sequence for clarity:
1. `results/chX/rqY/docs/`
2. `results/chX/rqY/data/`
3. `results/chX/rqY/code/`
4. `results/chX/rqY/logs/`
5. `results/chX/rqY/plots/`
6. `results/chX/rqY/results/`

**Note:** The sequence above is recommended for logical grouping (specifications → outputs → summaries), but agents may create folders in any order as they are independent.

---

## Verification Steps

**Before Creating Folders:**

1. **Check if root folder exists:**
   - If `results/chX/rqY/` does NOT exist → Create it
   - If `results/chX/rqY/` DOES exist → Proceed to step 2

2. **Verify root folder is empty (if it exists):**
   - Check `results/chX/rqY/` contains NO files and NO subdirectories
   - **Why:** Ensures we're starting fresh and not overwriting existing RQ work
   - **If not empty:** FAIL and report error - do NOT overwrite existing work

3. **After creating all 6 subfolders:**
   - Verify all 6 folders exist inside `results/chX/rqY/`
   - Verify each subfolder is empty (ready to receive files from subsequent agents)

**Verification Commands (Bash examples for reference):**
```bash
# Check if root exists and is empty
ls -la results/chX/rqY/

# After creation, verify all 6 folders exist
ls -la results/chX/rqY/ | grep -E "docs|data|code|logs|plots|results"
```

**Expected Result:**
```
results/chX/rqY/
  docs/      (empty)
  data/      (empty)
  code/      (empty)
  logs/      (empty)
  plots/     (empty)
  results/   (empty)
```

---

## Folder Purposes

Each folder has a specific purpose in the v4.X workflow:

### 1. **docs/** - RQ Specifications & Planning Documents

**Contains:**
- `1_concept.md` - RQ concept description (created by rq_concept agent)
- `2_plan.md` - Analysis plan with step-by-step workflow (created by rq_planner agent)
- `3_tools.yaml` - Tool specifications for analysis and validation (created by rq_tools agent)
- `4_analysis.yaml` - Analysis recipe with detailed step instructions (created by rq_analysis agent)

**Purpose:** Houses all RQ specification documents that define WHAT to analyze and HOW to analyze it.

**Created By:** rq_concept, rq_planner, rq_tools, rq_analysis agents (workflow steps 4, 9, 11, 12)

---

### 2. **data/** - Analysis Step Outputs

**Contains:**
- `stepN_name.csv` - CSV output files from each analysis step
  - Example: `step01_calibrate_irt.csv`, `step02_extract_theta.csv`
- Step naming convention: `stepNN_<verb>_<noun>.csv` (zero-padded number)

**Purpose:** Stores all data generated during analysis execution (theta scores, item parameters, model results, etc.)

**Created By:** g_code generated scripts during CODE EXECUTION LOOP (workflow step 14)

**Note:** Each CSV should have consistent column naming and data formats as specified in `4_analysis.yaml`

---

### 3. **code/** - Generated Python Scripts

**Contains:**
- `stepN_name.py` - Python script for each analysis step
  - Example: `step01_calibrate_irt.py`, `step02_extract_theta.py`
- Step naming convention: `stepNN_<verb>_<noun>.py` (matches data/ file naming)

**Purpose:** Houses all executable analysis scripts generated by g_code agent

**Created By:** g_code agent during CODE EXECUTION LOOP (workflow step 14)

**Note:** Each script contains:
- Analysis tool function calls from `3_tools.yaml`
- Validation tool function calls (embedded at end of each step)
- Input/output file paths from `4_analysis.yaml`
- Error handling and logging

---

### 4. **logs/** - Execution Logs

**Contains:**
- `stepN_name.log` - Execution log for each analysis step
  - Example: `step01_calibrate_irt.log`, `step02_extract_theta.log`
- Step naming convention: `stepNN_<verb>_<noun>.log` (matches code/ and data/ naming)

**Purpose:** Records execution output (stdout/stderr) for debugging and monitoring

**Created By:** Analysis scripts redirect output to log files during execution (workflow step 14)

**Note:** Logs capture:
- Script execution progress
- Analysis tool output messages
- Validation tool results (pass/fail)
- Error messages and stack traces (if failures occur)

---

### 5. **plots/** - Visualizations

**Contains:**
- `plots.py` - Plotting script (created by rq_plots agent)
- `plot_name.png` - Generated plot images
  - Example: `trajectory_theta.png`, `item_difficulty_distribution.png`
- Plot naming convention: From `docs/v4/names.md` registry

**Purpose:** Houses plotting script and all generated visualizations

**Created By:**
- `plots.py` created by rq_plots agent (workflow step 15)
- `.png` files created by running `plots.py` (workflow step 16)

**Note:** All plots use functions from `tools/plots.py` (rq_plots agent NEVER creates new plot functions, only calls existing ones)

---

### 6. **results/** - Final Summaries & Interpretations

**Contains:**
- `summary.md` - Results summary with findings, interpretations, limitations
- Additional result documents (if needed)

**Purpose:** Houses final publication-ready summaries and interpretations

**Created By:** rq_results agent (workflow step 17)

**Note:** `summary.md` sections:
1. Statistical Findings (key results from analysis)
2. Plot Descriptions (what each visualization shows)
3. Theoretical Interpretation (what results mean)
4. Limitations (methodological constraints)
5. Next Steps (recommendations for future RQs)

---

## Complete Structure Visualization

```
results/chX/rqY/                          (root RQ directory)
│
├── status.yaml                           (agent execution status, created by rq_builder)
│
├── docs/                                 (specifications & planning)
│   ├── 1_concept.md                     (RQ concept, rq_concept agent)
│   ├── 2_plan.md                        (analysis plan, rq_planner agent)
│   ├── 3_tools.yaml                     (tool specs, rq_tools agent)
│   └── 4_analysis.yaml                  (analysis recipe, rq_analysis agent)
│
├── data/                                 (analysis outputs)
│   ├── step01_calibrate_irt.csv         (IRT calibration results)
│   ├── step02_extract_theta.csv         (theta scores)
│   ├── step03_prepare_lmm.csv           (LMM-ready data)
│   └── stepN_name.csv                   (additional steps as needed)
│
├── code/                                 (generated scripts)
│   ├── step01_calibrate_irt.py          (IRT calibration script)
│   ├── step02_extract_theta.py          (theta extraction script)
│   ├── step03_prepare_lmm.py            (LMM preparation script)
│   └── stepN_name.py                    (additional scripts as needed)
│
├── logs/                                 (execution logs)
│   ├── step01_calibrate_irt.log         (IRT calibration log)
│   ├── step02_extract_theta.log         (theta extraction log)
│   ├── step03_prepare_lmm.log           (LMM preparation log)
│   └── stepN_name.log                   (additional logs as needed)
│
├── plots/                                (visualizations)
│   ├── plots.py                         (plotting script, rq_plots agent)
│   ├── trajectory_theta.png             (example plot 1)
│   ├── item_difficulty.png              (example plot 2)
│   └── plot_name.png                    (additional plots as needed)
│
└── results/                              (summaries & interpretations)
    └── summary.md                        (final results summary, rq_results agent)
```

**Legend:**
- **(root)** - Required directory created by rq_builder agent
- **(specifications & planning)** - Created by planning agents (steps 4, 9, 11, 12)
- **(analysis outputs)** - Created by analysis scripts during execution (step 14)
- **(generated scripts)** - Created by g_code agent (step 14)
- **(execution logs)** - Created by script execution (step 14)
- **(visualizations)** - Created by rq_plots agent and plot execution (steps 15-16)
- **(summaries & interpretations)** - Created by rq_results agent (step 17)

---

## File Naming Conventions

**Important:** File naming conventions are maintained in `docs/v4/names.md` registry.

**Step Files (stepN_name.*):**
- Pattern: `stepNN_<verb>_<noun>.<ext>`
- Number: Zero-padded (step01, step02, ..., step10, etc.)
- Verb: Action performed (calibrate, extract, prepare, fit, plot, etc.)
- Noun: Object of action (irt, theta, lmm, etc.)
- Extensions: .csv (data), .py (code), .log (logs)

**Examples:**
- `step01_calibrate_irt.csv` / `step01_calibrate_irt.py` / `step01_calibrate_irt.log`
- `step02_extract_theta.csv` / `step02_extract_theta.py` / `step02_extract_theta.log`
- `step03_prepare_lmm.csv` / `step03_prepare_lmm.py` / `step03_prepare_lmm.log`

**Plot Files:**
- Naming conventions specified in `docs/v4/names.md` (to be populated during RQ 5.1)
- Format: Descriptive names with underscores (e.g., `trajectory_theta.png`, `item_difficulty_distribution.png`)

**Consistency Rule:**
- Same step = same base name across data/, code/, logs/
- Example: step 1 creates `step01_calibrate_irt.csv`, `step01_calibrate_irt.py`, `step01_calibrate_irt.log` (all share base `step01_calibrate_irt`)

---

## Implementation Notes for rq_builder Agent

**What rq_builder Does:**
1. Reads `docs/v4/templates/agent_best_practices.md` (Step 1)
2. Reads this template `docs/v4/templates/build_folder.md` (Step 2)
3. Reads `docs/v4/templates/build_status.md` template (Step 3)
4. Creates `results/chX/rqY/` directory, verifies empty if exists (Step 4)
5. Creates all 6 subfolders per this specification (Step 5)
6. Creates `status.yaml` per build_status.md template (Step 6)
7. Reports success to master (Step 7)

**What rq_builder Does NOT Do:**
- Does NOT populate folders with files (other agents do this in subsequent steps)
- Does NOT create root-level files like 1_concept.md, 2_plan.md (other agents do this)
- Does NOT verify naming conventions (rq_analysis and g_code agents handle this)

**Folder Creation Method:**
- Template specifies WHAT to create (folder names, structure)
- rq_builder agent determines HOW to create (Bash mkdir, Write .gitkeep, etc.)
- Either approach acceptable as long as folders exist and are empty after Step 5

---

## Validation Architecture Integration

**v4.X Validation Gates:**
1. **rq_builder verification (Step 5):** All 6 folders exist and are empty
2. **g_code validation (Step 14):** Verifies input/output files exist before generating scripts
3. **rq_inspect validation (Step 14):** Verifies analysis outputs match plan.md expectations
4. **Embedded validation tools:** Each analysis step ends with validation tool call

**Folder Structure Support:**
- Clear separation of concerns: specifications (docs/), data (data/), code (code/), logs (logs/), visualizations (plots/), summaries (results/)
- Standard paths prevent errors (scripts know where to read/write)
- Consistent naming enables automated verification

---

## Version History

**Version 4.0 (2025-11-16):**
- Initial v4.X template specification
- 6-folder structure (docs/, data/, code/, logs/, plots/, results/)
- Replaces v3.0 5-folder structure (validation/, logs/, data/, code/, plots/)
- validation/ removed (validation now embedded in analysis steps)
- docs/ added (houses 4 specification documents)
- results/ added (houses final summary)

**v3.0 → v4.0 Migration Notes:**
- v3.0: Root-level info.md, config.yaml, status.md
- v4.0: Root-level status.yaml, specifications in docs/ subfolder
- v3.0: Scholar/stats reports in validation/ subfolder
- v4.0: Scholar/stats feedback appended to 1_concept.md (no separate validation/ folder)
- Both versions: Same data/, code/, logs/, plots/ structure (consistent)

---

**End of Template Specification**
